<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"  lang="en-us">
    <title>Careful with tryCatch - Econometrics and Free Software</title>
    <meta name="generator" content="Hugo 0.20.5" />

    
    <meta name="description" content="A blog about econometrics, free software, and R">
    
    <link rel="canonical" href="https://b-rodrigues.github.io/blog/2016-06-21-careful-with-trycatch/">
    
    <meta name="author" content="Bruno Rodrigues">
    
    <meta name="generator" content="Hugo 0.20.5" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:url" content="https://b-rodrigues.github.io/blog/2016-06-21-careful-with-trycatch/">
    <meta property="og:title" content="Econometrics and Free Software">
    <meta property="og:image" content="https://b-rodrigues.github.io/map[width:50 height:50 alt:Logo url:logo.png]">
    <meta name="apple-mobile-web-app-title" content="Econometrics and Free Software">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">

    
    <link rel="stylesheet" href="../../css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="../../css/custom.css">
    <link rel="stylesheet" href="../../css/pygments.css">
    
    <link rel="stylesheet" href="../../css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
  </head>
  <body>


<div class="row">
<div class="navbar navbar-default navbar-fixed-top">
<div class="container">
  <div class="navbar-header">
    <a href="https://b-rodrigues.github.io/" class="navbar-brand">Econometrics and Free Software</a>
    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse" id="navbar-main">

    <ul class="nav navbar-nav navbar-right">
      <li><a href="https://bitbucket.org/b-rodrigues/">Bitbucket</a></li>
      <li><a href="https://github.com/b-rodrigues/">Github</a></li>
      <li><a href="https://twitter.com/brodriguesco/">Twitter</a></li>
    </ul>
  </div>
</div>

</div>

<div class="container">

  <div>
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-4">
        

<div class="list-group table-of-contents">

  
    <a class="list-group-item" href=#><b>About Me</b></a>
    
    <div class="list-group">
      
      <a class="list-group-item" href="../../about/about/">Who am I?</a>
      
      <a class="list-group-item" href="../../about/projects/">Projects</a>
      
      <a class="list-group-item" href="../../about/research/">Research</a>
      
      <a class="list-group-item" href="../../about/software/">Software</a>
      
    </div>
    
  
    <a class="list-group-item" href=#><b>Blog</b></a>
    
    <div class="list-group">
      
      <a class="list-group-item" href="../../blog/2017-08-27-why_tidyeval/">Why I find tidyeval useful</a>
      
      <a class="list-group-item" href="../../blog/2017-07-27-spread_rename_at/">tidyr::spread() and dplyr::rename_at() in action</a>
      
      <a class="list-group-item" href="../../blog/2017-03-27-introducing_brotools/">Introducing brotools</a>
      
      <a class="list-group-item" href="../../blog/2017-06-19-dplyr-0-70-tutorial/">Lesser known dplyr 0.7* tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-02-17-lesser_known_tricks/">Lesser known dplyr tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-03-24-lesser_known_purrr/">Lesser known purrr tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-03-29-make-ggplot2-purrr/">Make ggplot2 purrr</a>
      
      <a class="list-group-item" href="../../blog/2016-12-24-functional-programming-and-unit-testing-for-data-munging-with-r-available-on-leanpub/">Functional programming and unit testing for data munging with R available on Leanpub</a>
      
      <a class="list-group-item" href="../../blog/2017-02-17-how_to_use_jailbreakr/">How to use jailbreakr</a>
      
      <a class="list-group-item" href="../../blog/2017-01-07-my-free-book-has-a-cover/">My free book has a cover!</a>
      
      <a class="list-group-item" href="../../blog/2016-12-21-work-on-lists-of-datasets-instead-of-individual-datasets-by-using-functional-programming/">Work on lists of datasets instead of individual datasets by using functional programming</a>
      
      <a class="list-group-item" href="../../blog/2013-01-29-method-of-simulated-moments-with-r/">Method of Simulated Moments with R</a>
      
      <a class="list-group-item" href="../../blog/2012-12-11-new-website/">New website!</a>
      
      <a class="list-group-item" href="../../blog/2013-11-07-gmm-with-rmd/">Nonlinear Gmm with R - Example with a logistic regression</a>
      
      <a class="list-group-item" href="../../blog/2013-01-16-simulated-maximum-likelihood-with-r/">Simulated Maximum Likelihood with R</a>
      
      <a class="list-group-item" href="../../blog/2015-11-11-bootstrapping-did-with-r/">Bootstrapping standard errors for difference-in-differences estimation with R</a>
      
      <a class="list-group-item" href="../../blog/2016-06-21-careful-with-trycatch/">Careful with tryCatch</a>
      
      <a class="list-group-item" href="../../blog/2016-07-18-data-frame-columns-as-arguments-to-dplyr-functions/">Data frame columns as arguments to dplyr functions</a>
      
      <a class="list-group-item" href="../../blog/2015-02-22-export-r-output-to-file/">Export R output to a file</a>
      
      <a class="list-group-item" href="../../blog/2016-11-04-ive-started-writing-a-book-functional-programming-and-unit-testing-for-data-munging-with-r/">I&#39;ve started writing a &#39;book&#39;: Functional programming and unit testing for data munging with R</a>
      
      <a class="list-group-item" href="../../blog/2015-01-12-introduction-to-programming-econometrics-with-r/">Introduction to programming econometrics with R</a>
      
      <a class="list-group-item" href="../../blog/2016-07-30-merge-a-list-of-datasets-together/">Merge a list of datasets together</a>
      
      <a class="list-group-item" href="../../blog/2014-04-23-r-s4-rootfinding/">Object Oriented Programming with R: An example with a Cournot duopoly</a>
      
      <a class="list-group-item" href="../../blog/2014-11-11-benchmarks-r-blas-atlas-rro/">R, R with Atlas, R with OpenBLAS and Revolution R Open: which is fastest?</a>
      
      <a class="list-group-item" href="../../blog/2016-07-26-read-a-lot-of-datasets-at-once-with-r/">Read a lot of datasets at once with R</a>
      
      <a class="list-group-item" href="../../blog/2016-03-31-unit-testing-with-r/">Unit testing with R</a>
      
      <a class="list-group-item" href="../../blog/2015-05-03-update-introduction-r-programming/">Update to Introduction to programming econometrics with R</a>
      
      <a class="list-group-item" href="../../blog/2013-12-31-r-cas/">Using R as a Computer Algebra System with Ryacas</a>
      
    </div>
    
  

</div>

      </div>
      <div class="col-lg-9 col-md-9 col-sm-8">
        <div>
           <h1 id="main">Careful with tryCatch</h1>
           <span class="article-date">March 31, 2016</span>
        </div>
        <!-- MathJax scripts -->

<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p><code>tryCatch</code> is one of the functions that allows the users to handle errors in a simple way. With it, you can do things like: <code>if(error), then(do this)</code>.</p>
<p>Take the following example:</p>
<pre class="r"><code>sqrt(&quot;a&quot;)
Error in sqrt(&quot;a&quot;) : non-numeric argument to mathematical function</code></pre>
<p>Now maybe you’d want something to happen when such an error happens. You can achieve that with <code>tryCatch</code>:</p>
<pre class="r"><code>tryCatch(sqrt(&quot;a&quot;), error=function(e) print(&quot;You can't take the square root of a character, silly!&quot;))</code></pre>
<pre><code>## [1] &quot;You can't take the square root of a character, silly!&quot;</code></pre>
<p>Why am I interested in <code>tryCatch</code>?</p>
<p>I am currently working with dates, specifically birthdays of people in my data sets. For a given mother, the birthday of her child is given in three distinct columns: a column for the child’s birth year, birth month and birth day respectively. I’ve wanted to put everything in a single column and convert the birthday to unix time (I have a very good reason to do that, but I won’t bore you with the details).</p>
<p>Let’s create some data:</p>
<pre class="r"><code>mother &lt;- as.data.frame(list(month=12, day=1, year=1988))</code></pre>
<p>In my data, there’s a lot more columns of course, such as the mother’s wage, education level, etc, but for illustration purposes, this is all that’s needed.</p>
<p>Now, to create this birthday column:</p>
<pre class="r"><code>mother$birth1 &lt;- as.POSIXct(paste0(as.character(mother$year), 
                                   &quot;-&quot;, as.character(mother$month), 
                                   &quot;-&quot;, as.character(mother$day)), 
                            origin=&quot;1970-01-01&quot;)</code></pre>
<p>and to convert it to unix time:</p>
<pre class="r"><code>mother$birth1 &lt;- as.numeric(as.POSIXct(paste0(as.character(mother$year), 
                                              &quot;-&quot;, as.character(mother$month), 
                                              &quot;-&quot;, as.character(mother$day)),
                                       origin=&quot;1970-01-01&quot;))

print(mother)</code></pre>
<pre><code>##   month day year    birth1
## 1    12   1 1988 596934000</code></pre>
<p>Now let’s see what happens in this other example here:</p>
<pre class="r"><code>mother2 &lt;- as.data.frame(list(month=2, day=30, year=1988))

mother2$birth1 &lt;- as.POSIXct(paste0(as.character(mother2$year), 
                                    &quot;-&quot;, as.character(mother2$month), 
                                    &quot;-&quot;, as.character(mother2$day)), 
                             origin=&quot;1970-01-01&quot;)</code></pre>
<p>This is what happens:</p>
<pre><code>Error in as.POSIXlt.character(x, tz, ...) : 
  character string is not in a standard unambiguous format</code></pre>
<p>This error is to be expected; there is no 30th of February! It turns out that in some rare cases, weird dates like this exist in my data. Probably some encoding errors. Not a problem I thought, I could use <code>tryCatch</code> and return <code>NA</code> in the case of an error.</p>
<pre class="r"><code>mother2 &lt;- as.data.frame(list(month=2, day=30, year=1988))

mother2$birth1 &lt;- tryCatch(as.POSIXct(paste0(as.character(mother2$year), 
                                    &quot;-&quot;, as.character(mother2$month), 
                                    &quot;-&quot;, as.character(mother2$day)), 
                             origin=&quot;1970-01-01&quot;), error=function(e) NA)

print(mother2)</code></pre>
<pre><code>##   month day year birth1
## 1     2  30 1988     NA</code></pre>
<p>Pretty great, right? Well, no. Take a look at what happens in this case:</p>
<pre class="r"><code>mother &lt;- as.data.frame(list(month=c(12, 2), day=c(1, 30), year=c(1988, 1987)))
print(mother)</code></pre>
<pre><code>##   month day year
## 1    12   1 1988
## 2     2  30 1987</code></pre>
<p>We’d expect to have a correct date for the first mother and an <code>NA</code> for the second. However, this is what happens</p>
<pre class="r"><code>mother$birth1 &lt;- tryCatch(as.POSIXct(paste0(as.character(mother$year), 
                                    &quot;-&quot;, as.character(mother$month), 
                                    &quot;-&quot;, as.character(mother$day)), 
                             origin=&quot;1970-01-01&quot;), error=function(e) NA)

print(mother)</code></pre>
<pre><code>##   month day year birth1
## 1    12   1 1988     NA
## 2     2  30 1987     NA</code></pre>
<p>As you can see, we now have an <code>NA</code> for both mothers! That’s actually to be expected. Indeed, this little example illustrates it well:</p>
<pre class="r"><code>sqrt(c(4, 9, &quot;haha&quot;))</code></pre>
<pre><code>Error in sqrt(c(4, 9, &quot;haha&quot;)) : 
  non-numeric argument to mathematical function</code></pre>
<p>But you’d like to have this:</p>
<pre><code>[1]  2  3 NA</code></pre>
<p>So you could make the same mistake as myself and use tryCatch:</p>
<pre class="r"><code>tryCatch(sqrt(c(4, 9, &quot;haha&quot;)), error=function(e) NA)</code></pre>
<pre><code>## [1] NA</code></pre>
<p>But you only get <code>NA</code> in return. That’s actually completely normal, but it took me off-guard and I spent quite some time to figure out what was happening. Especially because I had written unit tests to test my function <code>create_birthdays()</code> that was doing the above computations and all tests were passing! The problem was that in my tests, I only had a single individual, so for a wrong date, having <code>NA</code> for this individual was expected behaviour. But in a panel, only some individuals have a weird date like the 30th of February, but because of those, the whole column was filled with <code>NA</code>’s! What I’m doing now is trying to either remove these weird birthdays (there are mothers whose children were born on the 99-99-9999. Documentation is lacking, but this probably means <code>missing value</code>), or tyring to figure out how to only get <code>NA</code>’s for the “weird” dates. I guess that the answer lies with <code>dplyr</code>’s <code>group_by()</code> and <code>mutate()</code> to compute this birthdays for each individual separately.</p>

      </div>
    </div>
  <div class="row">
    <div class="col-lg-9 col-md-9 col-sm-8 col-lg-offset-3 col-md-offset-3">
    <footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Copyright 2017. <a> Bruno Rodrigues</a> </p>
      <p>Made with the HUGO theme <a href="https://github.com/adejoux/hugo-darkdoc-theme" rel="nofollow">darkdoc</a>.</p>
    </div>
  </div>
</footer>

</body>

    </div>
  </div>

</div>
</html>
<script>

  var api_url = '';

</script>
<script src="//code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="../../js/application.js"></script>
<script type="text/javascript" src="../../js/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<script type="text/javascript">
  $(document).ready(function() {
    $(".fancybox").fancybox();
  });
</script>

